dataset_id: Call_CDR
dataset_version: 3
description: Traffic asociated to cells that links to terminals that are not from
  this cells
field: TECHNOLOGY_CELL_CD
id: TECHNOLOGY_CELL_CD-TRAFFIC_NOT_CROSS_D_TECHNOLOGY_CELL_AND_IMEI_TAC_AND_D_TACS
id_jira: val-351
metrics:
- distribution
product: Neptuno, Canal 2.0
sources:
- dataset_id: IMEI_TAC
  dataset_version: 3
  name: IMEI_TAC
- dataset_id: D_TACS
  dataset_version: 4
  name: D_TACS
- dataset_id: D_Technology_Cell
  dataset_version: 3
  name: D_Technology_Cell
sql: SELECT to_json(collect_list((TOTAL, INCORRECT, PCT))) AS distribution FROM (select
  TOTAL, INCORRECT, cast(((INCORRECT * 100) / TOTAL) as decimal(3,2)) as PCT from
  (select sum(if(GBL_TECHNOLOGY_CELL_CD > PHONE_TECH, 1, 0)) as INCORRECT, count(1)
  as TOTAL from (select case when TECHNOLOGY_4G_OB_IND = 'LTE' then '4G' when TECHNOLOGY_3G_CD
  != 'No' then '3G' when TECHNOLOGY_2G_CD != 'No' then '2G' else '1G' end as PHONE_TECH,
  TECHNOLOGY_CELL_CD, GBL_TECHNOLOGY_CELL_CD from validation_data_table join IMEI_TAC
  on IMEI_1_ID = IMEI_ID join D_TACS on IMEI_TAC.TAC_ID = D_TACS.TAC_ID join D_Technology_Cell
  on LOCAL_TECHNOLOGY_CELL_CD = TECHNOLOGY_CELL_CD)))
